<?php
namespace Facebook\WebDriver;

use Facebook\WebDriver\Remote\DesiredCapabilities;
use Facebook\WebDriver\Remote\RemoteWebDriver;

/**
 * Must run with the command below due to different namespace of Facebook:
 * phpunit --bootstrap vendor/autoload.php tests/acceptance/FBBrowserOpenTest.php
 * classes without prefix '\' are run in Facebook\WebDriver namespace
 */
class FBBrowserOpenTest extends \PHPUnit_Framework_TestCase
{
	/**
	 * @var RemoteWebDriver
	 */
	protected $webDriver;

	public function setUp()
	{
		$this->webDriver = RemoteWebDriver::create(
			'http://localhost:4444/wd/hub',
			DesiredCapabilities::chrome()//or firexfox()
		);
	}

	/**
	 * Test opening the browser and asserts some dom elements
	 * This test ran successfully ;)
	 * @return void
	 */
	public function testOpenBrowser()
	{
		$this->webDriver->get('http://localhost:8000/');//The test page has only phpinfo(); as HTML content
		$content = $this->webDriver->findElement(WebDriverBy::tagName('body'))->getText();
		// $this->assertEquals('PHP Version 5.6.20-1+deb.sury.org~trusty+1', $content);
		$this->assertContains('PHP Version 5.6.20-1+deb.sury.org~trusty+1', $content);

		//Simulating and ajax call
		//Will wait on the callback for 2 seconds before continuing scripts below,
		//the call back is run every 300 milliseccons
		$this->webDriver->wait(2, 300)->until(function ($webDriver) {
			try{
				$webDriver->findElement(WebDriverBy::cssSelector('h1.p'));
				return true;
			}
			catch(NoSuchElementException $ex){
				return false;
			}
		});

		//This is run after the waitUntil finished in 2 seconds
		$content = $this->webDriver->findElement(WebDriverBy::cssSelector('h1.p'))->getText();
		$this->assertEquals('PHP Version 5.6.20-1+deb.sury.org~trusty+1', $content);

	}

	public function tearDown()
	{
		$this->webDriver->quit();
	}
}

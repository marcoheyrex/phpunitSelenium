<?php
/**
 * Must run without --bootstrap parameter in the command below:
 * phpunit tests/acceptance/BrowserOpenTest.php
 * User phpunit --bootstrap vendor/autoload.php when there are other namespaces like Facebook
 */
class BrowserOpenTest extends PHPUnit_Extensions_Selenium2TestCase
{
	public function setUp()
	{
		$this->setHost('localhost');
		$this->setPort(4444);
		$this->setBrowserURL('http://localhost:8000/');
		$this->setBrowser('chrome');
		// $this->setBrowser('firefox');
	}

	/**
	 * Test opening the browser and asserts some dom elements
	 * This test ran successfully ;)
	 * @return void
	 */
	public function testOpenBrowser()
	{
		$this->url('/');//The test page has only phpinfo(); as HTML content
		$content = $this->byTag('body')->text();
		// $this->assertEquals('PHP Version 5.6.20-1+deb.sury.org~trusty+1', $content);
		$this->assertContains('PHP Version 5.6.20-1+deb.sury.org~trusty+1', $content);

		//Simulating and ajax call
		//Will loop on the callback for 2 seconds before continuing scripts below
		// $this->timeouts()->implicitWait(300); //milliseconds
		$this->waitUntil(function(){
			try{
				// $webdriver->byId('rootElement');//select by id
				$this->byCssSelector('h1.p');//select by css

				return true;
			}catch (Exception $ex){
				return null;
			}
		}, 2000);//2 seconds
		//This is run after the waitUntil finished in 2 seconds
		$content = $this->byCssSelector('h1.p')->text();
		$this->assertEquals('PHP Version 5.6.20-1+deb.sury.org~trusty+1', $content);

	}

	public function tearDown()
	{
		$this->stop();
	}
}
